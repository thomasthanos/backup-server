<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - File Upload Server</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="dashboard">
    <nav class="navbar">
        <div class="navbar-brand">üìÅ File Server</div>
        <div class="navbar-menu">
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
            <a href="{{ url_for('account') }}">Account</a>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard-header">
            <h1>Welcome to Your Dashboard</h1>
            <p>Upload, manage, and organize your files securely</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        {% if category == 'success' %}
                            ‚úì
                        {% elif category == 'error' %}
                            ‚úó
                        {% else %}
                            ‚ö†
                        {% endif %}
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Breadcrumbs -->
        {% if current_folder or breadcrumbs %}
        <div class="breadcrumbs">
            <a href="{{ url_for('dashboard') }}" class="breadcrumb-item">üè† Home</a>
            {% for folder in breadcrumbs %}
                <span class="breadcrumb-separator">‚Ä∫</span>
                <a href="{{ url_for('dashboard', folder_id=folder.id) }}" class="breadcrumb-item">
                    üìÅ {{ folder.name }}
                </a>
            {% endfor %}
        </div>
        {% endif %}

        <div class="upload-section">
            <div class="upload-controls">
                <input type="text" 
                       id="folderNameInput" 
                       class="folder-input" 
                       placeholder="Enter folder name...">
                <button onclick="createFolder()" class="btn-create-folder">
                    üìÅ Create Folder
                </button>
            </div>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">‚òÅÔ∏è</div>
                <h3>Drop your files here</h3>
                <p>or click to browse</p>
                <button type="button" class="upload-btn">Choose File</button>
                <input type="file" id="fileInput" accept="*/*">
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Uploading...</div>
            </div>
        </div>

        <div class="files-section">
            {% if folders or files %}
                <h2>üìÇ {{ 'Current Folder' if current_folder else 'Your Files & Folders' }}</h2>
                
                <div class="items-grid">
                    <!-- Folders -->
                    {% for folder in folders %}
                        <div class="folder-card">
                            <div class="folder-icon">üìÅ</div>
                            <div class="folder-name">{{ folder.name }}</div>
                            <div class="folder-info">
                                <div>Created: {{ folder.created.split(' ')[0] }}</div>
                            </div>
                            <div class="folder-actions">
                                <a href="{{ url_for('dashboard', folder_id=folder.id) }}" class="btn-open">
                                    üìÇ Open
                                </a>
                                <button onclick="deleteFolder({{ folder.id }})" class="btn-delete">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    {% endfor %}

                    <!-- Files -->
                    {% for file in files %}
                        <div class="file-card">
                            <div class="file-icon">
                                {# Determine the file extension and choose an appropriate SVG icon #}
                                {% set ext = file.original_name.rsplit('.', 1)[-1].lower() if '.' in file.original_name else '' %}
                                {% set icon_path = 'icons/default.svg' %}
                                {# Common image formats #}
                                {% if ext in ['jpg','jpeg','png','gif','bmp','tiff','webp'] or file.mimetype.startswith('image/') %}
                                    {% set icon_path = 'icons/image.svg' %}
                                {# Common video formats #}
                                {% elif ext in ['mp4','avi','mkv','mov','wmv','flv','m4v'] or file.mimetype.startswith('video/') %}
                                    {% set icon_path = 'icons/video.svg' %}
                                {# Common audio formats #}
                                {% elif ext in ['mp3','wav','flac','aac','ogg','m4a'] or file.mimetype.startswith('audio/') %}
                                    {% set icon_path = 'icons/audio.svg' %}
                                {# PDF specifically #}
                                {% elif ext in ['pdf'] or 'pdf' in file.mimetype %}
                                    {% set icon_path = 'icons/document.svg' %}
                                {# Compressed archives #}
                                {% elif ext in ['zip','rar','7z','tar','gz','bz2','xz'] or 'zip' in file.mimetype or 'rar' in file.mimetype %}
                                    {% set icon_path = 'icons/archive.svg' %}
                                {# Word and plain text documents #}
                                {% elif ext in ['doc','docx','odt','rtf','txt'] or 'word' in file.mimetype or 'document' in file.mimetype %}
                                    {% set icon_path = 'icons/document.svg' %}
                                {# Spreadsheets #}
                                {% elif ext in ['xls','xlsx','csv','ods'] or 'excel' in file.mimetype or 'sheet' in file.mimetype %}
                                    {% set icon_path = 'icons/spreadsheet.svg' %}
                                {# Executable installers #}
                                {% elif ext in ['exe','msi','dmg','pkg','apk','app'] %}
                                    {% set icon_path = 'icons/executable.svg' %}
                                {# Source code and markup files #}
                                {% elif ext in ['py','js','ts','jsx','tsx','html','css','c','cpp','cc','cxx','java','cs','rb','go','rs','php','swift','kt','kts','dart','scala','lua','json','xml','yaml','yml'] %}
                                    {% set icon_path = 'icons/code.svg' %}
                                {% endif %}
                                <img src="{{ url_for('static', filename=icon_path) }}" alt="icon" class="file-icon-img">
                            </div>
                            <div class="file-name">{{ file.original_name }}</div>
                            <div class="file-info">
                                <div>{{ (file.size / 1024 / 1024) | round(2) }} MB</div>
                                <div>{{ file.uploaded.split(' ')[0] }}</div>
                            </div>
                            <div class="file-actions">
                                <a href="{{ url_for('download_file', file_id=file.id) }}" class="btn-download">
                                    ‚¨áÔ∏è Download
                                </a>
                                <button onclick="deleteFile({{ file.id }})" class="btn-delete">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üî≠</div>
                    <h3>No files or folders yet</h3>
                    <p>Create a folder or upload your first file to get started!</p>
                </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Fixed JavaScript syntax
        const currentFolderId = {% if current_folder %}{{ current_folder.id }}{% else %}null{% endif %};
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>